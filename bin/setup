#!/usr/bin/env ruby
require 'pathname'
dir = Pathname.new(__FILE__).realpath + "../../dotfiles"

def exec command
  #puts command
  output = `#{command}`
  $stderr.puts output unless $?.success?
end

Dir.glob(File.join(dir, "*"), File::FNM_DOTMATCH).each do |dotfile|
  next if File.directory? dotfile
  basename = File.basename dotfile
  home_dotfile = File.expand_path('~/' + basename)
  exec "cp \"#{dotfile}\" ~/" unless File.exists? home_dotfile
  exec "rm \"#{dotfile}\" && mv \"#{home_dotfile}\" \"#{dir}\" && ln -s \"#{dotfile}\" ~/"
end

